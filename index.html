<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>KART BROS - FIXED</title>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
        canvas { width: 100% !important; height: 100% !important; background: #000; }
        #loading { position: absolute; color: #555; font-family: sans-serif; pointer-events: none; }
    </style>
</head>
<body>
    <div id="loading">SHADERS INITIALIZING...</div>
    <canvas id="unity-canvas"></canvas>

    <script>
        // --- THE "ANTI-CRASH" SHIELD ---
        // 1. Fake the Ad SDKs entirely
        window.aiptag = { cmd: { display: [], player: [] }, adcalled: true };
        window.Main = { 
            DoneVideoAd: function() { console.log("Ad Fake Success"); return true; },
            ShowAd: function() { return true; },
            ShowVideo: function() { return true; }
        };

        // 2. Hijack Network calls to stop CORS/WebSocket hangs
        const ignoreUrls = ['ping', 'kart', 'google', 'analytics', 'ads'];
        const bakedFetch = window.fetch;
        window.fetch = function(url, options) {
            if (ignoreUrls.some(term => String(url).includes(term))) {
                return Promise.resolve(new Response(JSON.stringify({status:'ok'}), {status: 200}));
            }
            return bakedFetch.apply(this, arguments);
        };

        // 3. Suppress the specific NullReference Crash
        window.onerror = function(message) {
            if (message.includes("NullReferenceException")) {
                console.warn("Caught game crash - forcing continuation...");
                return true; // Prevents the browser from stopping the script
            }
        };
    </script>

    <script src="Build/1c5c2b799f24adb3aee763b89a42a07b.loader.js"></script>
    <script>
        createUnityInstance(document.querySelector("#unity-canvas"), {
            dataUrl: "Build/e7e6a46b3086885e8d87f10a010ccb74.data.unityweb",
            frameworkUrl: "Build/649344238019636530d089f7c59360f7.framework.js.unityweb",
            codeUrl: "Build/fbaee9566eaf23158954926b50c27e61.wasm.unityweb",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "Blue Wizard Digital",
            productName: "Kart Bros",
            productVersion: "1.62",
            devicePixelRatio: 1,
            autoSyncPersistentDataPath: true,
            webglContextAttributes: { 
                alpha: false, 
                antialias: false, 
                depth: true, 
                preserveDrawingBuffer: true,
                preferLowPowerToHighPerformance: false 
            }
        }).then((instance) => {
            document.getElementById('loading').remove();
            // Force the game to realize ads are "done" 5 seconds after boot
            setTimeout(() => {
                instance.SendMessage('AdsManager', 'OnAdClosed');
                instance.SendMessage('GameManager', 'OnAdClosed');
            }, 5000);
        });
    </script>
</body>
</html>
